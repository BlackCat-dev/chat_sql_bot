# chat_sql_bot

**chat_sql_bot** — это веб-приложение на Flask, которое переводит запросы на русском языке в SQL-запросы с помощью модели T5. Оно предназначено для демонстрации и тестирования моделей генерации SQL по текстовому описанию, автоматизации работы с базой данных сотрудников и научных работ, а также для анализа и визуализации результатов.

## Основные возможности

- Веб-интерфейс для ввода естественного запроса на русском и вывода результата SQL-запроса к базе данных (SQLite).
- Использование предварительно обученной модели T5 для генерации SQL на лету.
- Логирование всех пользовательских взаимодействий.
- Скрипты для генерации синтетических датасетов, анализа ошибок, построения метрик BLEU и точного совпадения (Exact Match).
- Демонстрационные данные сотрудников и научных публикаций.

---

## Структура репозитория

- **app.py**  
  Flask-приложение. Основная точка входа.  
  - Загружает модель и токенизатор T5, обрабатывает POST-запросы, вызывает генерацию SQL, выполняет запрос в SQLite, отображает результат через шаблон.
  - Логирует взаимодействия через `log_interaction.py`.

- **analysis_of_differences.py**  
  Визуализация и анализ различий между эталонными и предсказанными SQL-запросами.  
  - Подсвечивает отличия в HTML.
  - Использует pandas, difflib, IPython.display.

- **charts.py**  
  Визуализация BLEU-метрик и точных совпадений.  
  - Строит графики по результатам тестирования.
  - Использует matplotlib, seaborn, nltk.

- **db_init.py**  
  Скрипт инициализации базы данных `data/database.db`.  
  - Создаёт таблицы сотрудников и научных работ.
  - Заполняет их демонстрационными данными.
  - Очищает старые записи.

- **generate_synthetic_text_sql_pairs.py**  
  Генерация синтетического датасета (русский текст ↔ SQL).  
  - Сохраняет пары в `synthetic_rus_text_sql.csv`.
  - Поддерживает разнообразные шаблоны запросов.

- **log_interaction.py**  
  Модуль логирования взаимодействий с моделью в CSV-файл (`logs/interaction_log.csv`).

- **metrics.py**  
  Скрипт оценки точности и BLEU модели на тестовой выборке.  
  - Сохраняет результаты в `data/evaluation_results.csv`.

- **test_t5_sql_generation.py**  
  Модуль тестирования генерации SQL по тексту.
  - Использует "мягкое" сравнение SQL с эталоном.

- **data/**  
  Каталог с моделью, базой данных, обучающими и тестовыми датасетами.

- **model/**  
  (Резерв для моделей или их компонентов.)

- **logs/**  
  Каталог для логов взаимодействий.

- **static/**  
  Каталог для статических файлов Flask (css, js, картинки).

- **templates/**  
  HTML-шаблоны для Flask.

- **synthetic_rus_text_sql.csv**  
  Синтетический датасет пар русских текстов и SQL-запросов.

---

## Быстрый старт

1. **Установите зависимости:**
   ```bash
   pip install -r requirements.txt
   ```

2. **Инициализируйте базу данных:**
   ```bash
   python db_init.py
   ```

3. **Запустите веб-приложение:**
   ```bash
   python app.py
   ```
   По умолчанию будет доступно на http://localhost:5000

4. **(Опционально) Сгенерируйте синтетический датасет:**
   ```bash
   python generate_synthetic_text_sql_pairs.py
   ```

---

## Пример использования

- Введите текстовый запрос на русском, например:  
  `Показать всех сотрудников института химии`
- Получите результат выполнения соответствующего SQL-запроса.
- Логи взаимодействий сохраняются в `logs/interaction_log.csv`.

---

## Зависимости (requirements.txt)

```
flask
sqlite3
torch
transformers
pandas
matplotlib
seaborn
nltk
scikit-learn
ipython
```

---

## Лицензия

Проект распространяется по лицензии MIT. См. файл [LICENSE](./LICENSE).

---

## Контакты

Автор: [BlackCat-dev](https://github.com/BlackCat-dev)

---
